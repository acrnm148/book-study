## 3.1

## 3.2

## 3.3 CrudRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ CRUD ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•
ğŸ“Œ spring-dataì™€ spring-data-commons ëª¨ë“ˆ
```
[build.gradle]
...
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
implementation 'org.springframework.boot:spring-boot-starter-data-redis'
...
```
- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë§Œ ë³´ë”ë¼ë„ core, test, MVC ë“± ì—¬ëŸ¬ ëª¨ë“ˆì´ ìˆê³ 
  ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬, ìŠ¤í”„ë§ ë¶€íŠ¸, ìŠ¤í”„ë§ ë°ì´í„°, ìŠ¤í”„ë§ í´ë¼ìš°ë“œ ë“± ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë“¤ì´ ì¡´ì¬í•¨.
- [ê³µì‹ë¬¸ì„œ](https://spring.io/projects/spring-data)
  
![image](https://github.com/acrnm148/book-study/assets/67724306/71211ea7-f2da-4af5-af3a-51b6b844d21b)

- spring-data
  - ê¸°ë³¸ ë°ì´í„° ì €ì¥ì†Œ(DB)ì— ëŒ€í•œ íŠ¹ì„±ì€ ìœ ì§€í•˜ë©°, ë°ì´í„° ì ‘ê·¼ ë°©ë²•ì— ëŒ€í•´ ì¹œìˆ™í•œ ì ‘ê·¼ ë°©ë²•ì„ ì œì‹œí•˜ëŠ” Spring ê¸°ë°˜ í”„ë¡œê·¸ë˜ë° ëª¨ë¸.
  - ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•´ ë§Œë“¤ì–´ì§„ íŠ¹ì •í•œ í•˜ìœ„ í”„ë¡œì íŠ¸ë“¤ë¡œ êµ¬ì„±ëœ ìš°ì‚°í˜• í”„ë¡œì íŠ¸.
  - CRUD ë™ì‘ì´ í•„ìš”. Spring dataëŠ” Repositoryë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ, ê° ë°ì´í„° ì €ì¥ì†ŒëŠ” ì´ Repositoryë¥¼ êµ¬í˜„í•˜ì—¬ ìì‹ ì˜ ë°ì´í„° ì €ì¥ì†Œì— ë§ëŠ” repositoryë¥¼ ì œê³µí•œë‹¤.
    - ex) JpaRepository, MongoRepository ...
  - êµ¬ì„±
  
![image](https://github.com/acrnm148/book-study/assets/67724306/7a75017a-91ee-45b9-8b85-c40bacf5fb53)
![image](https://github.com/acrnm148/book-study/assets/67724306/38948101-730d-4e9b-a1c8-d8f586f8d8a0)
- [spring-data-commons](https://github.com/spring-projects/spring-data-commons/tree/main/src/main/java/org/springframework/data/repository) : Repsotiroy ì¸í„°í˜ì´ìŠ¤, CrudRepository, PagingAndSortingRepository, ...
- í•˜ìœ„ í”„ë¡œì íŠ¸ë“¤ : spring-data-jpa, spring-data-redis ...

â“ [Starters](https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-starters)
  - spring-boot-starterëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì— ì¢…ì†ì„±ì„ í¬í•¨ì‹œí‚´ìœ¼ë¡œì¨ í•„ìš”í•œ ëª¨ë“  ê´€ë ¨ ê¸°ìˆ ì„ ì›ìŠ¤í†±ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” 'í¸ë¦¬í•œ ì¢…ì†ì„± ì„¸íŠ¸'


### 1. Repository ì¸í„°í˜ì´ìŠ¤
- `spring-data-commons` ëª¨ë“ˆì— í¬í•¨ë˜ì–´ ìˆìŒ.
- spring data repository ëª¨ë“ˆì€ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„° ì†ŒìŠ¤ ì ‘ê·¼ì„ ì¶”ìƒí™”
- Repository ì¸í„°í˜ì´ìŠ¤ëŠ” `ë„ë©”ì¸ í´ë˜ìŠ¤` + `ì‹ë³„ì íƒ€ì…`ì„ í•„ìš”ë¡œ í•œë‹¤.
  - ë„ë©”ì¸ í´ë˜ìŠ¤ = DBì— ì €ì¥ë˜ì–´ ê´€ë¦¬ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì—”í‹°í‹° í´ë˜ìŠ¤
- ë©”ì„œë“œë‚˜ ìƒìˆ˜ë¥¼ í¬í•¨ X, ì˜¤ì§ ê°ì²´ì˜ ëŸ°íƒ€ì„ íƒ€ì… ì •ë³´ë§Œì„ ì•Œë ¤ì£¼ëŠ” ë§ˆì»¤ ì¸í„°í˜ì´ìŠ¤

### 2. CrudRepository
- Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì€ í•˜ìœ„ ì¸í„°í˜ì´ìŠ¤
- CRUD ì—°ì‚°ì„ í¬í•¨í•˜ê³  ìˆìŒ.
- ì œë„ˆë¦­ íƒ€ì… T : ë„ë©”ì¸ í´ë˜ìŠ¤, ID : ë„ë©”ì¸ í´ë˜ìŠ¤ì˜ ì‹ë³„ì
```java
@NoRepositoryBean
public interface CrudRepository<T, ID> extends Repository<T, ID> {
	<S extends T> S save(S entity);
	<S extends T> Iterable<S> saveAll(Iterable<S> entities);
	Optional<T> findById(ID id);
	boolean existsById(ID id);
	Iterable<T> findAll();
	Iterable<T> findAllById(Iterable<ID> ids);
	long count();
	void deleteById(ID id);
	void delete(T entity);
	void deleteAllById(Iterable<? extends ID> ids);
	void deleteAll(Iterable<? extends T> entities);
	void deleteAll();
}
```

### 3. PagingAndSortingRepository ì¸í„°í˜ì´ìŠ¤
- CrudRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ì¸í„°í˜ì´ìŠ¤
- í˜ì´ì§•, ì •ë ¬ ê¸°ëŠ¥ í¬í•¨
```java
@NoRepositoryBean
public interface PagingAndSortingRepository<T, ID> extends Repository<T, ID> {
	Iterable<T> findAll(Sort sort);
	Page<T> findAll(Pageable pageable);
}
```


## 3.3.1 ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•´ì„œ ë„ë©”ì¸ ê°ì²´ë¥¼ RDBMSì—ì„œ ê´€ë¦¬
- ë„ë©”ì¸ í´ë˜ìŠ¤
```java
```
- ì£¼ìš” annotation
```java
@Entity : JPAë¡œ ê´€ë¦¬ë˜ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤
@Table : í•´ë‹¹ ì—”í‹°í‹°ê°€ ì €ì¥ë˜ëŠ” í…Œì´ë¸” ì´ë¦„ (ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì—”í‹°í‹° ì´ë¦„ì„ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©.)
@Column : ìë°” í•„ë“œ ì •ë³´ì™€ í…Œì´ë¸” ì»¬ëŸ¼ ì •ë³´ë¥¼ ë§¤í•‘ => camelCaseë¼ë©´ ì»¬ëŸ¼ëª…ì€ camel_case ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“¤ì–´ì§„ë‹¤.
@Id : í…Œì´ë¸”ì˜ PK (ìœ ì¼í•œ ë°ì´í„°ë¡œ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì‹ë³„ì) => â“JPAì— ì˜í•´ ìë™ ìƒì„±ë˜ë¯€ë¡œ ìƒì„±ìì—ëŠ” idí•„ë“œê°€ í¬í•¨ë¼ìˆì§€ ì•ŠìŒ.
@GeneratedValue : ì‹ë³„ìë¡œ ì‚¬ìš©ë˜ëŠ” idê°’ì´ ìë™ ìƒì„±ë¨(ê°œë°œìê°€ ì§€ì •X) => ìë™ ìƒì„± ì „ëµì„ ì§€ì •í•  ìˆ˜ ìˆìŒ.
	1. Table: í‚¤ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ê³ , ì´ í…Œì´ë¸”ì—ì„œ í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ì´ë¥¼ PKë¡œ ì‚¬ìš©
	2. Identity: PKì»¬ëŸ¼ì—ì„œ ìƒì„±ëœ ê°’ì„ PKë¡œ ì‚¬ìš©
	3. Sequence : ì‹œí€€ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ í‚¤ ìƒì„±, ì´ë¥¼ PKë¡œ ì‚¬ìš©
	4. Auto: JPAêµ¬í˜„ì²´ê°€ ê¸°ë³¸ í‚¤ ìƒì„± ë°©ì‹ì„ ìŠ¤ìŠ¤ë¡œ ê²°ì •
```
- ìŠ¤í”„ë§ ë°ì´í„° ë ˆí¬ì§€í† ë¦¬
```java
```
- ì£¼ìš” annotation
```java
@Repository
- ë‘ ê°€ì§€ ëª©ì 
1. ìë™ ê°ì§€: @Component ì–´ë…¸í…Œì´ì…˜ì„ í¬í•¨í•˜ê³  ìˆì–´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ê³¼ì •ì—ì„œ íƒì§€ë¨.
2. ì˜ˆì™¸ ë³€í™˜: Exceptionì€ JPA êµ¬í˜„ì²´(í•˜ì´ë²„ë„¤ì´íŠ¸, ì´í´ë¦½ìŠ¤ë§í¬, ...)ì— ë”°ë¼ ë‹¬ë¼ì§
	=> ê°ê° ë‹¤ë¥¸ ì˜ˆì™¸ë¥¼ í•˜ë‚˜í•˜ë‚˜ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì´ë¥¼ ë³€í™˜í•˜ëŠ” ì¶”ê°€ ì‘ì—…ì´ í•„ìš”í•¨ => @Repositoryìœ¼ë¡œ í•´ê²°
	=> @RepositoryëŠ” Exceptionì„ DataAccessExceptionìœ¼ë¡œ ë³€í™˜í•´ì¤Œ => DataAccessExceptionë§Œ ì²˜ë¦¬í•´ì£¼ë©´ ë¨.
```

- application.yml
```java
spring.jpa.hibernate.ddl-auto=create
=> ddl-autoëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œë§Œ ë™ì‘í•˜ëŠ” í”„ë¡œí¼í‹° (ë‹¤ë¥¸ êµ¬í˜„ì²´: spring.jpa.generate-ddl í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©)
1. none: DDLìë™ìƒì„± ê¸°ëŠ¥ ë¹„í™œì„±í™”
2. validate: ì‹¤ì œ DBìŠ¤í‚¤ë§ˆì™€ ìë™ ìƒì„±ë˜ëŠ” DDLì„ ë¹„êµ ê²€ì¦í•´ì„œ ì°¨ì´ê°€ ìˆìœ¼ë©´ DBë°˜ì˜X + ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì—ëŸ¬ ë°œìƒ
3. update: ì‹¤ì œ DBìŠ¤í‚¤ë§ˆì™€ ìë™ ìƒì„±ë˜ëŠ” DDLì„ ë¹„êµ ê²€ì¦í•´ì„œ ì°¨ì´ê°€ ìˆìœ¼ë©´ DDL ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì„ DBì— ë°˜ì˜
4. create: ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ ìŠ¤í‚¤ë§ˆì™€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ìŠ¤í‚¤ë§ˆë¥¼ ìƒˆë¡œ ìƒì„±
5. create-drop: ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ ìŠ¤í‚¤ë§ˆì™€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ìŠ¤í‚¤ë§ˆ ìƒˆë¡œ ìƒì„± + ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ ìŠ¤í‚¤ë§ˆì™€ ë°ì´í„° ì‚­ì œ
```



## 3.3.2 ì»¤ìŠ¤í…€ ìŠ¤í”„ë§ ë°ì´í„° ë ˆí¬ì§€í† ë¦¬ë¥¼ ë§Œë“¤ì–´ì„œ RDBMSì—ì„œ ë„ë©”ì¸ ê°ì²´ ê´€ë¦¬

