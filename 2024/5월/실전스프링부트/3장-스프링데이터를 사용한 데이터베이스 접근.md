> - [3.1](3.1)
> - [3.2](3.2)
> - [3.3 CrudRepository μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•΄μ„ CRUD μ—°μ‚°μ„ μν–‰ν•λ” λ°©λ²•](#3.3-CrudRepository-μΈν„°νμ΄μ¤λ¥Ό-μ‚¬μ©ν•΄μ„-CRUD-μ—°μ‚°μ„-μν–‰ν•λ”-λ°©λ²•)



## 3.1

## 3.2

## 3.3 CrudRepository μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•΄μ„ CRUD μ—°μ‚°μ„ μν–‰ν•λ” λ°©λ²•
π“ spring-dataμ™€ spring-data-commons λ¨λ“
```
[build.gradle]
...
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
implementation 'org.springframework.boot:spring-boot-starter-data-redis'
...
```
- μ¤ν”„λ§ ν”„λ μ„μ›ν¬λ§ λ³΄λ”λΌλ„ core, test, MVC λ“± μ—¬λ¬ λ¨λ“μ΄ μκ³ 
  μ¤ν”„λ§ ν”„λ μ„μ›ν¬, μ¤ν”„λ§ λ¶€νΈ, μ¤ν”„λ§ λ°μ΄ν„°, μ¤ν”„λ§ ν΄λΌμ°λ“ λ“± μ—¬λ¬ ν”„λ΅μ νΈλ“¤μ΄ μ΅΄μ¬ν•¨.
- [κ³µμ‹λ¬Έμ„](https://spring.io/projects/spring-data)
  
![image](https://github.com/acrnm148/book-study/assets/67724306/71211ea7-f2da-4af5-af3a-51b6b844d21b)

- spring-data
  - κΈ°λ³Έ λ°μ΄ν„° μ €μ¥μ†(DB)μ— λ€ν• νΉμ„±μ€ μ μ§€ν•λ©°, λ°μ΄ν„° μ ‘κ·Ό λ°©λ²•μ— λ€ν•΄ μΉμ™ν• μ ‘κ·Ό λ°©λ²•μ„ μ μ‹ν•λ” Spring κΈ°λ° ν”„λ΅κ·Έλλ° λ¨λΈ.
  - κ°κ°μ λ°μ΄ν„°λ² μ΄μ¤μ— λ€ν•΄ λ§λ“¤μ–΄μ§„ νΉμ •ν• ν•μ„ ν”„λ΅μ νΈλ“¤λ΅ κµ¬μ„±λ μ°μ‚°ν• ν”„λ΅μ νΈ.
  - CRUD λ™μ‘μ΄ ν•„μ”. Spring dataλ” RepositoryλΌλ” μΈν„°νμ΄μ¤λ¥Ό μ κ³µ, κ° λ°μ΄ν„° μ €μ¥μ†λ” μ΄ Repositoryλ¥Ό κµ¬ν„ν•μ—¬ μμ‹ μ λ°μ΄ν„° μ €μ¥μ†μ— λ§λ” repositoryλ¥Ό μ κ³µν•λ‹¤.
    - ex) JpaRepository, MongoRepository ...
  - κµ¬μ„±
  
![image](https://github.com/acrnm148/book-study/assets/67724306/7a75017a-91ee-45b9-8b85-c40bacf5fb53)
![image](https://github.com/acrnm148/book-study/assets/67724306/38948101-730d-4e9b-a1c8-d8f586f8d8a0)
- [spring-data-commons](https://github.com/spring-projects/spring-data-commons/tree/main/src/main/java/org/springframework/data/repository) : Repsotiroy μΈν„°νμ΄μ¤, CrudRepository, PagingAndSortingRepository, ...
- ν•μ„ ν”„λ΅μ νΈλ“¤ : spring-data-jpa, spring-data-redis ...

β“ [Starters](https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-starters)
  - spring-boot-starterλ” μ‘μ© ν”„λ΅κ·Έλ¨μ— μΆ…μ†μ„±μ„ ν¬ν•¨μ‹ν‚΄μΌλ΅μ¨ ν•„μ”ν• λ¨λ“  κ΄€λ ¨ κΈ°μ μ„ μ›μ¤ν†±μΌλ΅ μ΄μ©ν•  μ μλ” 'νΈλ¦¬ν• μΆ…μ†μ„± μ„ΈνΈ'


### 1. Repository μΈν„°νμ΄μ¤
- `spring-data-commons` λ¨λ“μ— ν¬ν•¨λμ–΄ μμ.
- spring data repository λ¨λ“μ€ Repository μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•΄μ„ λ°μ΄ν„° μ†μ¤ μ ‘κ·Όμ„ μ¶”μƒν™”
- Repository μΈν„°νμ΄μ¤λ” `λ„λ©”μΈ ν΄λμ¤` + `μ‹λ³„μ νƒ€μ…`μ„ ν•„μ”λ΅ ν•λ‹¤.
  - λ„λ©”μΈ ν΄λμ¤ = DBμ— μ €μ¥λμ–΄ κ΄€λ¦¬λλ” λΉ„μ¦λ‹μ¤ μ—”ν‹°ν‹° ν΄λμ¤
- λ©”μ„λ“λ‚ μƒμλ¥Ό ν¬ν•¨ X, μ¤μ§ κ°μ²΄μ λ°νƒ€μ„ νƒ€μ… μ •λ³΄λ§μ„ μ•λ ¤μ£Όλ” λ§μ»¤ μΈν„°νμ΄μ¤

### 2. CrudRepository
- Repository μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›μ€ ν•μ„ μΈν„°νμ΄μ¤
- CRUD μ—°μ‚°μ„ ν¬ν•¨ν•κ³  μμ.
- μ λ„λ¦­ νƒ€μ… T : λ„λ©”μΈ ν΄λμ¤, ID : λ„λ©”μΈ ν΄λμ¤μ μ‹λ³„μ
```java
@NoRepositoryBean
public interface CrudRepository<T, ID> extends Repository<T, ID> {
	<S extends T> S save(S entity);
	<S extends T> Iterable<S> saveAll(Iterable<S> entities);
	Optional<T> findById(ID id);
	boolean existsById(ID id);
	Iterable<T> findAll();
	Iterable<T> findAllById(Iterable<ID> ids);
	long count();
	void deleteById(ID id);
	void delete(T entity);
	void deleteAllById(Iterable<? extends ID> ids);
	void deleteAll(Iterable<? extends T> entities);
	void deleteAll();
}
```

### 3. PagingAndSortingRepository μΈν„°νμ΄μ¤
- CrudRepository μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›λ” μΈν„°νμ΄μ¤
- νμ΄μ§•, μ •λ ¬ κΈ°λ¥ ν¬ν•¨
```java
@NoRepositoryBean
public interface PagingAndSortingRepository<T, ID> extends Repository<T, ID> {
	Iterable<T> findAll(Sort sort);
	Page<T> findAll(Pageable pageable);
}
```


## 3.3.1 μ¤ν”„λ§ λ°μ΄ν„° JPAλ¥Ό μ‚¬μ©ν•΄μ„ λ„λ©”μΈ κ°μ²΄λ¥Ό RDBMSμ—μ„ κ΄€λ¦¬
- λ„λ©”μΈ ν΄λμ¤
```java
@Entity
@Table(name="PROFILE")
@AllArgsConstructor
@NoArgsConstructor
public class Profile {
    @Id
    @Column(name = "mmbr_num")
    private Long memberNum;

    @Column(name = "ncnm")
    private String nickName;

    @Column(name = "pfile_phtg_file_urladrs")
    private String imgUrl;
}
```
- μ£Όμ” annotation
```java
@Entity : JPAλ΅ κ΄€λ¦¬λλ” μ—”ν‹°ν‹° ν΄λμ¤
@Table : ν•΄λ‹Ή μ—”ν‹°ν‹°κ°€ μ €μ¥λλ” ν…μ΄λΈ” μ΄λ¦„ (μ§€μ •ν•΄μ£Όμ§€ μ•μΌλ©΄ μ—”ν‹°ν‹° μ΄λ¦„μ„ ν…μ΄λΈ” μ΄λ¦„μΌλ΅ μ‚¬μ©.)
@Column : μλ°” ν•„λ“ μ •λ³΄μ™€ ν…μ΄λΈ” μ»¬λΌ μ •λ³΄λ¥Ό λ§¤ν•‘ => camelCaseλΌλ©΄ μ»¬λΌλ…μ€ camel_case μ–Έλ”μ¤μ½”μ–΄λ¥Ό μ‚¬μ©ν•΄μ„ λ§λ“¤μ–΄μ§„λ‹¤.
@Id : ν…μ΄λΈ”μ PK (μ μΌν• λ°μ΄ν„°λ΅ μ‹λ³„ν•  μ μλ” μ‹λ³„μ) => β“JPAμ— μν•΄ μλ™ μƒμ„±λλ―€λ΅ μƒμ„±μμ—λ” idν•„λ“κ°€ ν¬ν•¨λΌμμ§€ μ•μ.
@GeneratedValue : μ‹λ³„μλ΅ μ‚¬μ©λλ” idκ°’μ΄ μλ™ μƒμ„±λ¨(κ°λ°μκ°€ μ§€μ •X) => μλ™ μƒμ„± μ „λµμ„ μ§€μ •ν•  μ μμ.
	1. Table: ν‚¤ ν…μ΄λΈ”μ„ λ”°λ΅ λ§λ“¤κ³ , μ΄ ν…μ΄λΈ”μ—μ„ ν‚¤λ¥Ό μƒμ„±ν•μ—¬ μ΄λ¥Ό PKλ΅ μ‚¬μ©
	2. Identity: PKμ»¬λΌμ—μ„ μƒμ„±λ κ°’μ„ PKλ΅ μ‚¬μ©
	3. Sequence : μ‹ν€€μ¤λ¥Ό μ‚¬μ©ν•΄μ„ ν‚¤ μƒμ„±, μ΄λ¥Ό PKλ΅ μ‚¬μ©
	4. Auto: JPAκµ¬ν„μ²΄κ°€ κΈ°λ³Έ ν‚¤ μƒμ„± λ°©μ‹μ„ μ¤μ¤λ΅ κ²°μ •
```
- μ¤ν”„λ§ λ°μ΄ν„° λ ν¬μ§€ν† λ¦¬
```java
@Repository
public interface ProfileRepository extends CrudRepository<Profile, Long> {
}
=> μΈν„°νμ΄μ¤ λ‚΄μ©μ΄ λΉ„μ–΄μλ”λΌλ„ spring data jpaκ°€ λ°νƒ€μ„μ— μΈν„°νμ΄μ¤ κµ¬ν„μ²΄λ¥Ό μλ™μΌλ΅ λ§λ“¤μ–΄μ¤.
λ•λ¶„μ— μΈν„°νμ΄μ¤ λ‚΄μ©μ„ λ”°λ΅ μ‘μ„±ν•μ§€ μ•μ•„λ„ κΈ°λ³Έμ μΈ CRUD μ—°μ‚°μ„ μν–‰ν•  μ μμ.
```
- μ£Όμ” annotation
```java
@Repository: μ΄ λ¦¬ν¬μ§€ν† λ¦¬κ°€ μ¤ν”„λ§ λ¦¬ν¬μ§€ν† λ¦¬λ΅ μ‚¬μ©λλ‹¤λ” κ²ƒμ„ μ•λ ¤μ¤.
- λ‘ κ°€μ§€ λ©μ 
1. μλ™ κ°μ§€: @Component μ–΄λ…Έν…μ΄μ…μ„ ν¬ν•¨ν•κ³  μμ–΄ μ»΄ν¬λ„νΈ μ¤μΊ” κ³Όμ •μ—μ„ νƒμ§€λ¨.
2. μμ™Έ λ³€ν™: Exceptionμ€ JPA κµ¬ν„μ²΄(ν•μ΄λ²„λ„¤μ΄νΈ, μ΄ν΄λ¦½μ¤λ§ν¬, ...)μ— λ”°λΌ λ‹¬λΌμ§
	=> κ°κ° λ‹¤λ¥Έ μμ™Έλ¥Ό ν•λ‚ν•λ‚ μ²λ¦¬ν•΄μ¤„ μ μ—†μΌλ―€λ΅ μ΄λ¥Ό λ³€ν™ν•λ” μ¶”κ°€ μ‘μ—…μ΄ ν•„μ”ν•¨ => @RepositoryμΌλ΅ ν•΄κ²°
	=> @Repositoryλ” Exceptionμ„ DataAccessExceptionμΌλ΅ λ³€ν™ν•΄μ¤ => DataAccessExceptionλ§ μ²λ¦¬ν•΄μ£Όλ©΄ λ¨.
```

- application.yml
```java
spring.jpa.hibernate.ddl-auto=create
=> ddl-autoλ” ν•μ΄λ²„λ„¤μ΄νΈμ—μ„λ§ λ™μ‘ν•λ” ν”„λ΅νΌν‹° (λ‹¤λ¥Έ κµ¬ν„μ²΄: spring.jpa.generate-ddl ν”„λ΅νΌν‹°λ¥Ό μ‚¬μ©)
1. none: DDLμλ™μƒμ„± κΈ°λ¥ λΉ„ν™μ„±ν™”
2. validate: μ‹¤μ  DBμ¤ν‚¤λ§μ™€ μλ™ μƒμ„±λλ” DDLμ„ λΉ„κµ κ²€μ¦ν•΄μ„ μ°¨μ΄κ°€ μμΌλ©΄ DBλ°μX + μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹ μ—λ¬ λ°μƒ
3. update: μ‹¤μ  DBμ¤ν‚¤λ§μ™€ μλ™ μƒμ„±λλ” DDLμ„ λΉ„κµ κ²€μ¦ν•΄μ„ μ°¨μ΄κ°€ μμΌλ©΄ DDL κΈ°μ¤€μΌλ΅ λ³€κ²½μ‚¬ν•­μ„ DBμ— λ°μ
4. create: κΈ°μ΅΄μ— μ΅΄μ¬ν•λ μ¤ν‚¤λ§μ™€ λ°μ΄ν„°λ¥Ό μ‚­μ ν•κ³  μ¤ν‚¤λ§λ¥Ό μƒλ΅ μƒμ„±
5. create-drop: κΈ°μ΅΄μ— μ΅΄μ¬ν•λ μ¤ν‚¤λ§μ™€ λ°μ΄ν„°λ¥Ό μ‚­μ ν•κ³  μ¤ν‚¤λ§ μƒλ΅ μƒμ„± + μ• ν”λ¦¬μΌ€μ΄μ… μΆ…λ£ μ‹ μ¤ν‚¤λ§μ™€ λ°μ΄ν„° μ‚­μ 
```



## 3.3.2 μ»¤μ¤ν…€ μ¤ν”„λ§ λ°μ΄ν„° λ ν¬μ§€ν† λ¦¬λ¥Ό λ§λ“¤μ–΄μ„ RDBMSμ—μ„ λ„λ©”μΈ κ°μ²΄ κ΄€λ¦¬

